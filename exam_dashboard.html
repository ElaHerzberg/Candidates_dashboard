<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>דשבורד מבחן מיון — ניתוח נתונים</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;600;800;900&family=Space+Mono:wght@400;700&display=swap');

  :root {
    --bg: #0d0f14;
    --surface: #161a24;
    --surface2: #1e2535;
    --border: #2a3045;
    --text: #e8ecf5;
    --muted: #7a8499;
    --bg-dot: #121520;

    --c1: #5b8dee;  /* B/G */
    --c2: #4ecdc4;  /* A */
    --c3: #ffe66d;  /* Junior */
    --c4: #ff6b6b;  /* Fail */
    --c5: #c77dff;  /* Conditional */

    --accent: #5b8dee;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    background-image: radial-gradient(circle at 20% 20%, #1a2540 0%, transparent 50%),
                      radial-gradient(circle at 80% 80%, #1a1f35 0%, transparent 50%);
    color: var(--text);
    font-family: 'Heebo', sans-serif;
    min-height: 100vh;
    padding: 2rem 1.5rem 4rem;
  }

  header {
    text-align: center;
    margin-bottom: 3rem;
    position: relative;
  }

  header::after {
    content: '';
    display: block;
    width: 120px;
    height: 3px;
    background: linear-gradient(90deg, var(--c1), var(--c2));
    margin: 1.2rem auto 0;
    border-radius: 2px;
  }

  h1 {
    font-size: clamp(1.6rem, 4vw, 2.4rem);
    font-weight: 900;
    letter-spacing: -0.02em;
    color: var(--text);
  }

  h1 span {
    background: linear-gradient(135deg, var(--c1), var(--c2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .subtitle {
    color: var(--muted);
    margin-top: 0.5rem;
    font-size: 0.95rem;
    font-weight: 300;
  }

  .grid {
    display: grid;
    gap: 1.5rem;
    max-width: 1300px;
    margin: 0 auto;
  }

  .grid-2 { grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); }
  .grid-3 { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 1.5rem 1.8rem;
    position: relative;
    overflow: hidden;
    transition: border-color 0.2s;
  }

  .card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
    border-radius: 16px 16px 0 0;
  }

  .card.c1::before { background: linear-gradient(90deg, var(--c1), #3a6bd4); }
  .card.c2::before { background: linear-gradient(90deg, var(--c2), #2a9d96); }
  .card.c3::before { background: linear-gradient(90deg, var(--c3), #e6c823); }
  .card.c4::before { background: linear-gradient(90deg, var(--c4), #d94444); }
  .card.c5::before { background: linear-gradient(90deg, var(--c5), #9b59b6); }
  .card.multi::before { background: linear-gradient(90deg, var(--c1), var(--c2), var(--c3), var(--c4)); }

  .card:hover { border-color: #3d4a6a; }

  .card-title {
    font-size: 0.8rem;
    font-weight: 600;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 1.2rem;
    font-family: 'Space Mono', monospace;
  }

  .chart-wrap {
    position: relative;
  }

  /* KPI Cards */
  .kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
    max-width: 1300px;
    margin: 0 auto 1.5rem;
  }

  .kpi {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 1.2rem;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .kpi-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
    margin: 0 auto 0.6rem;
  }

  .kpi-num {
    font-size: 2rem;
    font-weight: 900;
    line-height: 1;
    font-family: 'Space Mono', monospace;
  }

  .kpi-label {
    font-size: 0.78rem;
    color: var(--muted);
    margin-top: 0.4rem;
    font-weight: 400;
  }

  /* Insight box */
  .insight {
    background: var(--surface2);
    border-right: 3px solid var(--accent);
    padding: 0.9rem 1.1rem;
    border-radius: 0 10px 10px 0;
    margin-top: 1rem;
    font-size: 0.85rem;
    color: #b0bcda;
    line-height: 1.6;
  }

  .insight strong { color: var(--text); }

  /* Legend */
  .legend {
    display: flex;
    flex-wrap: wrap;
    gap: 0.8rem;
    margin-top: 1rem;
    font-size: 0.78rem;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    color: var(--muted);
  }

  .legend-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .span-2 { grid-column: 1 / -1; }

  section-label {
    display: block;
    font-family: 'Space Mono', monospace;
    font-size: 0.7rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
    margin: 2rem 0 0.8rem;
    max-width: 1300px;
    margin-left: auto;
    margin-right: auto;
    padding: 0 0.2rem;
  }

  @media (max-width: 600px) {
    .grid-2, .grid-3 { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<header>
  <h1>ניתוח מבחן <span>מיון מדריכים</span></h1>
  <p class="subtitle">853 מועמדים · בדיקה אוטומטית + ידנית</p>
</header>

<!-- KPI Row -->
<div class="kpi-grid">
  <div class="kpi">
    <div class="kpi-dot" style="background: var(--c1)"></div>
    <div class="kpi-num" style="color: var(--c1)">249</div>
    <div class="kpi-label">עברו ב'/ג'</div>
  </div>
  <div class="kpi">
    <div class="kpi-dot" style="background: var(--c2)"></div>
    <div class="kpi-num" style="color: var(--c2)">186</div>
    <div class="kpi-label">עברו א'</div>
  </div>
  <div class="kpi">
    <div class="kpi-dot" style="background: var(--c3)"></div>
    <div class="kpi-num" style="color: var(--c3)">197</div>
    <div class="kpi-label">עברו ג'וניור</div>
  </div>
  <div class="kpi">
    <div class="kpi-dot" style="background: var(--c4)"></div>
    <div class="kpi-num" style="color: var(--c4)">158</div>
    <div class="kpi-label">לא עברו</div>
  </div>
  <div class="kpi">
    <div class="kpi-dot" style="background: var(--c5)"></div>
    <div class="kpi-num" style="color: var(--c5)">55</div>
    <div class="kpi-label">תנאי ראיון</div>
  </div>
</div>

<!-- Row 1 -->
<div class="grid grid-2" style="max-width:1300px;margin:0 auto;">

  <!-- Chart 1: Distribution donut -->
  <div class="card multi">
    <div class="card-title">התפלגות תוצאות סופיות</div>
    <div class="chart-wrap" style="height:260px">
      <canvas id="donut"></canvas>
    </div>
    <div class="insight">
      <strong>41%</strong> מהמועמדים עברו לב'/ג' — יותר מכל קבוצה אחרת. 
      רק <strong>18%</strong> נכשלו לגמרי.
    </div>
  </div>

  <!-- Chart 2: Radar - avg scores by decision -->
  <div class="card c1">
    <div class="card-title">פרופיל ציונים ממוצעים לפי תוצאה</div>
    <div class="chart-wrap" style="height:260px">
      <canvas id="radar"></canvas>
    </div>
    <div class="insight">
      ציון <strong>א'</strong> הוא המבדיל המרכזי: ב'/ג' ← 75 בממוצע, א' בלבד ← 62, ג'וניור ← 17.
    </div>
  </div>

</div>

<!-- Row 2 -->
<div class="grid grid-2" style="max-width:1300px;margin:1.5rem auto 0;">

  <!-- Chart 3: Score distribution stacked bar for A score -->
  <div class="card c2">
    <div class="card-title">התפלגות ציון א' לפי תוצאה ידנית</div>
    <div class="chart-wrap" style="height:280px">
      <canvas id="stackedA"></canvas>
    </div>
    <div class="insight">
      <strong>79%</strong> מהנכשלים קיבלו 0 בא'. 
      לעומת זאת, <strong>62%</strong> מעברי ב'/ג' קיבלו 100.
    </div>
  </div>

  <!-- Chart 4: Auto 100 B/G → Human outcome -->
  <div class="card c3">
    <div class="card-title">אוטומטי 100 לב'/ג' → תוצאה ידנית</div>
    <div class="chart-wrap" style="height:280px">
      <canvas id="autoDisconnect"></canvas>
    </div>
    <div class="insight">
      מתוך <strong>483</strong> מועמדים שקיבלו ציון 100 אוטומטי לב'/ג' — רק <strong>48%</strong> אכן עברו לב'/ג'. 
      הבדיקה הידנית מורידה משמעותית.
    </div>
  </div>

</div>

<!-- Row 3 -->
<div class="grid" style="max-width:1300px;margin:1.5rem auto 0;grid-template-columns:1fr;">

  <!-- Chart 5: Keyword mentions heatmap -->
  <div class="card multi">
    <div class="card-title">אזכורי נושאים בהערות הבודק — לפי תוצאה (%)</div>
    <div class="chart-wrap" style="height:320px">
      <canvas id="keywords"></canvas>
    </div>
    <div class="insight">
      <strong>קוד סיבובים</strong> מוזכר ב-95% מהערות קבוצת התנאי — הנושא הכי שנוי במחלוקת. 
      <strong>ירושה</strong> בולטת כמבדיל בין א' לב'/ג'. 
      <strong>AI</strong> — חשד גבוה יותר בקבוצת התנאי (25%) לעומת נכשלים (11%).
    </div>
  </div>

</div>

<!-- Row 4 -->
<div class="grid grid-2" style="max-width:1300px;margin:1.5rem auto 0;">

  <!-- Chart 6: B/G score breakdown per group -->
  <div class="card c4">
    <div class="card-title">התפלגות ציון ב'/ג' לפי תוצאה</div>
    <div class="chart-wrap" style="height:280px">
      <canvas id="bgDist"></canvas>
    </div>
    <div class="insight">
      אצל הנכשלים: <strong>66%</strong> קיבלו 0, אך <strong>28%</strong> קיבלו 100 — ונכשלו בגלל הבדיקה הידנית (לרוב ליבי או הוראות).
    </div>
  </div>

  <!-- Chart 7: Conditional group profile -->
  <div class="card c5">
    <div class="card-title">קבוצת התנאי — פרופיל ייחודי</div>
    <div class="chart-wrap" style="height:280px">
      <canvas id="conditional"></canvas>
    </div>
    <div class="insight">
      קבוצת התנאי: ציון ב'/ג' ממוצע גבוה (<strong>70</strong>) אך ציון א' נמוך (<strong>30</strong>). 
      חשד AI גבוה ביחס לכולם (<strong>25%</strong>).
    </div>
  </div>

</div>

<script>
// ── Palette ──────────────────────────────────
const C = {
  bg: '#5b8dee',
  a: '#4ecdc4',
  jr: '#ffe66d',
  fail: '#ff6b6b',
  cond: '#c77dff',
  muted: '#7a8499',
};

const GROUPS = ["ב'/ג'", "א'", "ג'וניור", "נכשל", "תנאי"];
const COLORS = [C.bg, C.a, C.jr, C.fail, C.cond];

function hexAlpha(hex, a) {
  const r = parseInt(hex.slice(1,3),16);
  const g = parseInt(hex.slice(3,5),16);
  const b = parseInt(hex.slice(5,7),16);
  return `rgba(${r},${g},${b},${a})`;
}

const defaultFont = { family: "'Heebo', sans-serif", size: 12, color: '#7a8499' };
Chart.defaults.color = '#7a8499';
Chart.defaults.font = defaultFont;
Chart.defaults.plugins.legend.labels.boxWidth = 10;
Chart.defaults.plugins.legend.labels.padding = 14;

// ── 1. Donut ───────────────────────────────
new Chart(document.getElementById('donut'), {
  type: 'doughnut',
  data: {
    labels: ["ב'/ג' (249)", "א' (186)", "ג'וניור (197)", "לא עבר (158)", "תנאי (55)"],
    datasets: [{
      data: [249, 186, 197, 158, 55],
      backgroundColor: COLORS,
      borderColor: '#161a24',
      borderWidth: 3,
      hoverOffset: 8,
    }]
  },
  options: {
    cutout: '65%',
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { position: 'right', labels: { color: '#b0bcda', font: { size: 11 } } },
      tooltip: { rtl: true }
    }
  }
});

// ── 2. Radar ───────────────────────────────
new Chart(document.getElementById('radar'), {
  type: 'radar',
  data: {
    labels: ["ג'וניור", "א'", "ב'/ג'"],
    datasets: [
      { label: "ב'/ג'", data: [93.5, 75.4, 94.8], borderColor: C.bg, backgroundColor: hexAlpha(C.bg, 0.15), pointBackgroundColor: C.bg, borderWidth: 2 },
      { label: "א'", data: [93.0, 61.6, 58.8], borderColor: C.a, backgroundColor: hexAlpha(C.a, 0.1), pointBackgroundColor: C.a, borderWidth: 2 },
      { label: "ג'וניור", data: [88.8, 17.1, 43.3], borderColor: C.jr, backgroundColor: hexAlpha(C.jr, 0.1), pointBackgroundColor: C.jr, borderWidth: 2 },
      { label: "לא עבר", data: [69.9, 9.5, 31.2], borderColor: C.fail, backgroundColor: hexAlpha(C.fail, 0.1), pointBackgroundColor: C.fail, borderWidth: 2 },
      { label: "תנאי", data: [84.5, 29.6, 69.7], borderColor: C.cond, backgroundColor: hexAlpha(C.cond, 0.1), pointBackgroundColor: C.cond, borderWidth: 2 },
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      r: {
        min: 0, max: 100,
        ticks: { stepSize: 25, color: '#4a5570', backdropColor: 'transparent', font: { size: 10 } },
        grid: { color: '#2a3045' },
        pointLabels: { color: '#b0bcda', font: { size: 12, weight: '600' } },
        angleLines: { color: '#2a3045' }
      }
    },
    plugins: {
      legend: { position: 'bottom', labels: { color: '#b0bcda', font: { size: 10 }, padding: 10 } }
    }
  }
});

// ── 3. Stacked bar — A score dist ─────────
// Data: 0 | 1-49 | 50-74 | 100
const aData = {
  labels: GROUPS,
  zero:   [10.8, 24.2, 70.1, 79.7, 43.6],
  low:    [14.9, 15.1, 16.2, 14.6, 36.4],
  mid:    [11.6, 12.4,  6.1,  3.2,  7.3],
  top:    [62.7, 48.4,  7.6,  2.5, 12.7],
};

new Chart(document.getElementById('stackedA'), {
  type: 'bar',
  data: {
    labels: GROUPS,
    datasets: [
      { label: '100', data: aData.top, backgroundColor: C.a, borderRadius: 3 },
      { label: '50-74', data: aData.mid, backgroundColor: hexAlpha(C.a, 0.6) },
      { label: '1-49', data: aData.low, backgroundColor: hexAlpha(C.a, 0.35) },
      { label: '0', data: aData.zero, backgroundColor: hexAlpha(C.fail, 0.5) },
    ]
  },
  options: {
    responsive: true, maintainAspectRatio: false,
    scales: {
      x: { stacked: true, grid: { color: '#2a3045' }, ticks: { color: '#b0bcda' } },
      y: { stacked: true, grid: { color: '#2a3045' }, ticks: { color: '#7a8499', callback: v => v + '%' }, max: 100 }
    },
    plugins: { legend: { position: 'bottom', labels: { color: '#b0bcda', font: { size: 10 }, padding: 10 } }, tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': ' + ctx.raw + '%' } } }
  }
});

// ── 4. Auto 100 → Human outcome ────────────
new Chart(document.getElementById('autoDisconnect'), {
  type: 'bar',
  data: {
    labels: ["עבר ב'/ג'", "עבר א'", "עבר ג'וניור", "לא עבר", "תנאי"],
    datasets: [{
      label: 'מועמדים עם ציון 100 אוטומטי לב׳/ג׳',
      data: [230, 102, 73, 44, 34],
      backgroundColor: [C.bg, C.a, C.jr, C.fail, C.cond],
      borderRadius: 6,
    }]
  },
  options: {
    indexAxis: 'y',
    responsive: true, maintainAspectRatio: false,
    scales: {
      x: { grid: { color: '#2a3045' }, ticks: { color: '#7a8499' } },
      y: { grid: { display: false }, ticks: { color: '#b0bcda' } }
    },
    plugins: { legend: { display: false } }
  }
});

// ── 5. Keywords heatmap-style grouped bar ──
const kwLabels = ['ליבי', 'סיבובים', 'קוד לא רץ', 'ירושה', 'יחס אישי', 'AI'];
const kwData = {
  "ב'/ג'": [86, 68, 61, 29, 22, 15],
  "א'":    [89, 78, 56, 41, 25, 5],
  "ג'וניור": [90, 77, 50, 22, 26, 10],
  "נכשל":  [81, 57, 44, 10, 13, 11],
  "תנאי":  [95, 95, 85, 40, 11, 25],
};

new Chart(document.getElementById('keywords'), {
  type: 'bar',
  data: {
    labels: kwLabels,
    datasets: Object.entries(kwData).map(([label, data], i) => ({
      label,
      data,
      backgroundColor: hexAlpha(COLORS[i], 0.8),
      borderColor: COLORS[i],
      borderWidth: 1,
      borderRadius: 4,
    }))
  },
  options: {
    responsive: true, maintainAspectRatio: false,
    scales: {
      x: { grid: { color: '#2a3045' }, ticks: { color: '#b0bcda' } },
      y: { grid: { color: '#2a3045' }, ticks: { color: '#7a8499', callback: v => v + '%' }, max: 100 }
    },
    plugins: { legend: { position: 'bottom', labels: { color: '#b0bcda', font: { size: 10 }, padding: 12 } } }
  }
});

// ── 6. B/G score distribution ─────────────
const bgDist = {
  labels: GROUPS,
  zero:  [3.6, 36.6, 51.3, 66.5, 25.5],
  low:   [0.8, 5.4, 4.6, 1.3, 1.8],
  mid:   [3.2, 3.2, 7.1, 4.4, 10.9],
  top:   [92.4, 54.8, 37.1, 27.8, 61.8],
};

new Chart(document.getElementById('bgDist'), {
  type: 'bar',
  data: {
    labels: GROUPS,
    datasets: [
      { label: '100', data: bgDist.top, backgroundColor: C.bg, borderRadius: 3 },
      { label: '50-74', data: bgDist.mid, backgroundColor: hexAlpha(C.bg, 0.5) },
      { label: '1-49', data: bgDist.low, backgroundColor: hexAlpha(C.bg, 0.3) },
      { label: '0', data: bgDist.zero, backgroundColor: hexAlpha(C.fail, 0.55) },
    ]
  },
  options: {
    responsive: true, maintainAspectRatio: false,
    scales: {
      x: { stacked: true, grid: { color: '#2a3045' }, ticks: { color: '#b0bcda' } },
      y: { stacked: true, grid: { color: '#2a3045' }, ticks: { color: '#7a8499', callback: v => v + '%' }, max: 100 }
    },
    plugins: { legend: { position: 'bottom', labels: { color: '#b0bcda', font: { size: 10 }, padding: 10 } }, tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': ' + ctx.raw + '%' } } }
  }
});

// ── 7. Conditional group highlight ────────
new Chart(document.getElementById('conditional'), {
  type: 'bar',
  data: {
    labels: GROUPS,
    datasets: [
      {
        label: "ממוצע ציון ג'וניור",
        data: [93.5, 93.0, 88.8, 69.9, 84.5],
        backgroundColor: groups => groups.index === 4 ? C.cond : hexAlpha(C.jr, 0.5),
        backgroundColor: [hexAlpha(C.jr, 0.4), hexAlpha(C.jr, 0.4), hexAlpha(C.jr, 0.4), hexAlpha(C.jr, 0.4), C.jr],
        borderRadius: 5,
        borderSkipped: false,
      },
      {
        label: "ממוצע ציון א'",
        data: [75.4, 61.6, 17.1, 9.5, 29.6],
        backgroundColor: [hexAlpha(C.a, 0.4), hexAlpha(C.a, 0.4), hexAlpha(C.a, 0.4), hexAlpha(C.a, 0.4), C.a],
        borderRadius: 5,
        borderSkipped: false,
      },
      {
        label: "ממוצע ציון ב'/ג'",
        data: [94.8, 58.8, 43.3, 31.2, 69.7],
        backgroundColor: [hexAlpha(C.bg, 0.4), hexAlpha(C.bg, 0.4), hexAlpha(C.bg, 0.4), hexAlpha(C.bg, 0.4), C.bg],
        borderRadius: 5,
        borderSkipped: false,
      },
    ]
  },
  options: {
    responsive: true, maintainAspectRatio: false,
    scales: {
      x: { grid: { color: '#2a3045' }, ticks: { color: '#b0bcda' } },
      y: { grid: { color: '#2a3045' }, ticks: { color: '#7a8499', callback: v => v }, max: 100 }
    },
    plugins: {
      legend: { position: 'bottom', labels: { color: '#b0bcda', font: { size: 10 }, padding: 10 } },
      tooltip: {}
    }
  }
});
</script>
</body>
</html>
